{% extends "base.html" %}
{% block content %}
<div class="row g-4">
  <div class="col-lg-4" data-aos="fade-up">
    <div class="card p-3 card-elevated">
      <h5 class="mb-2">Current Budget</h5>
      {% if budget %}
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <div class="fw-bold">{{ budget.month }}</div>
            <div class="small">Budget: ${{ '%.2f' % budget.amount }}</div>
            <div class="small text-muted">Created: {{ budget.created_at.strftime('%Y-%m-%d') }}</div>
          </div>
          <div>
            <button class="btn btn-sm btn-outline-light" id="deleteBudgetBtn" data-budget-id="{{ budget.id }}">
              <i class="fa fa-trash"></i>
            </button>
          </div>
        </div>
        <div class="mt-3">
          <div class="progress" style="height:18px;background:#222;">
            <div id="budgetProgress" class="progress-bar" role="progressbar" style="width: {{ usage_pct }}%;">
              {{ usage_pct }}%
            </div>
          </div>
          <div class="small mt-2">Spent: ${{ '%.2f' % total_spent }} / ${{ '%.2f' % budget.amount }}</div>
        </div>
      {% else %}
        <p class="text-muted">No budget set for {{ now().strftime('%B %Y') if false else ''}}</p>
        <a href="/set-budget" class="btn btn-sm btn-light">Set Budget</a>
      {% endif %}
    </div>
  </div>

  <div class="col-lg-8" data-aos="fade-up" data-aos-delay="100">
    <div class="card p-3 card-elevated">
      <h5 class="mb-3">Expenses Overview</h5>
      <canvas id="expenseChart" height="100"></canvas>
    </div>
  </div>

  <div class="col-12" data-aos="fade-up" data-aos-delay="200">
    <div class="card p-3 card-elevated">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <h5 class="mb-0">Recent Expenses</h5>
        <a href="/add-expense" class="btn btn-sm btn-light">Add New</a>
      </div>

      {% if expenses %}
      <div class="table-responsive">
        <table class="table table-dark table-striped align-middle">
          <thead>
            <tr>
              <th>Category</th>
              <th>Amount</th>
              <th>Note</th>
              <th>Date</th>
              <th class="text-end">Actions</th>
            </tr>
          </thead>
          <tbody id="expensesTableBody">
            {% for e in expenses %}
            <tr id="exp-{{ e.id }}">
              <td>{{ e.category }}</td>
              <td>${{ '%.2f' % e.amount }}</td>
              <td>{{ e.note or '' }}</td>
              <td>{{ e.date.strftime('%Y-%m-%d') }}</td>
              <td class="text-end">
                <button class="btn btn-sm btn-outline-light me-1 editExpenseBtn" data-expense='{{ e.to_dict() | tojson }}'>
                  <i class="fa fa-pen"></i>
                </button>
                <button class="btn btn-sm btn-outline-danger deleteExpenseBtn" data-id="{{ e.id }}">
                  <i class="fa fa-trash"></i>
                </button>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
        <p class="text-muted">No expenses yet. Add your first expense.</p>
      {% endif %}
    </div>
  </div>
</div>

<script>
const expenseLabels = {{ categories|tojson }};
const expenseData = {{ amounts|tojson }};
const totalSpent = {{ total_spent }};
</script>
<script src="{{ url_for('static', filename='js/charts.js') }}"></script>
{% endblock %}
